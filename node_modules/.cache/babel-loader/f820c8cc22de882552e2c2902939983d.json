{"ast":null,"code":"import { isRealNumber } from '../../utils/number';\nimport { transformDataToNodeLinkData } from '../../utils/data';\nimport { sankeyLayout } from './layout';\nimport { cutoffCircle } from './circle';\nexport function getNodeWidthRatio(nodeWidth, nodeWidthRatio, width) {\n  return isRealNumber(nodeWidth) ? nodeWidth / width : nodeWidthRatio;\n}\nexport function getNodePaddingRatio(nodePadding, nodePaddingRatio, height) {\n  return isRealNumber(nodePadding) ? nodePadding / height : nodePaddingRatio;\n}\n/**\n * 将桑基图配置经过 layout，生成最终的 view 数据\n * @param options\n * @param width\n * @param height\n */\n\nexport function transformToViewsData(options, width, height) {\n  var data = options.data,\n      sourceField = options.sourceField,\n      targetField = options.targetField,\n      weightField = options.weightField,\n      nodeAlign = options.nodeAlign,\n      nodeSort = options.nodeSort,\n      nodePadding = options.nodePadding,\n      nodePaddingRatio = options.nodePaddingRatio,\n      nodeWidth = options.nodeWidth,\n      nodeWidthRatio = options.nodeWidthRatio,\n      nodeDepth = options.nodeDepth;\n  var sankeyLayoutInputData = transformDataToNodeLinkData(cutoffCircle(data, sourceField, targetField), sourceField, targetField, weightField); // 3. layout 之后的数据\n\n  var _a = sankeyLayout({\n    nodeAlign: nodeAlign,\n    nodePadding: getNodePaddingRatio(nodePadding, nodePaddingRatio, height),\n    nodeWidth: getNodeWidthRatio(nodeWidth, nodeWidthRatio, width),\n    nodeSort: nodeSort,\n    nodeDepth: nodeDepth\n  }, sankeyLayoutInputData),\n      nodes = _a.nodes,\n      links = _a.links; // 4. 生成绘图数据\n\n\n  return {\n    nodes: nodes.map(function (node) {\n      return {\n        x: node.x,\n        y: node.y,\n        name: node.name,\n        isNode: true\n      };\n    }),\n    edges: links.map(function (link) {\n      return {\n        source: link.source.name,\n        target: link.target.name,\n        name: link.source.name || link.target.name,\n        x: link.x,\n        y: link.y,\n        value: link.value,\n        isNode: false\n      };\n    })\n  };\n}","map":{"version":3,"sources":["../../../src/plots/sankey/helper.ts"],"names":[],"mappings":"AAAA,SAAS,YAAT,QAA6B,oBAA7B;AACA,SAAS,2BAAT,QAA4C,kBAA5C;AACA,SAAS,YAAT,QAA6B,UAA7B;AACA,SAAS,YAAT,QAA6B,UAA7B;AAGA,OAAM,SAAU,iBAAV,CAA4B,SAA5B,EAA+C,cAA/C,EAAuE,KAAvE,EAAoF;AACxF,SAAO,YAAY,CAAC,SAAD,CAAZ,GAA0B,SAAS,GAAG,KAAtC,GAA8C,cAArD;AACD;AAED,OAAM,SAAU,mBAAV,CAA8B,WAA9B,EAAmD,gBAAnD,EAA6E,MAA7E,EAA2F;AAC/F,SAAO,YAAY,CAAC,WAAD,CAAZ,GAA4B,WAAW,GAAG,MAA1C,GAAmD,gBAA1D;AACD;AAED;;;;;AAKG;;AACH,OAAM,SAAU,oBAAV,CAA+B,OAA/B,EAAuD,KAAvD,EAAsE,MAAtE,EAAoF;AAEtF,MAAA,IAAI,GAWF,OAAO,CAXL,IAAJ;AAAA,MACA,WAAW,GAUT,OAAO,CAVE,WADX;AAAA,MAEA,WAAW,GAST,OAAO,CATE,WAFX;AAAA,MAGA,WAAW,GAQT,OAAO,CARE,WAHX;AAAA,MAIA,SAAS,GAOP,OAAO,CAPA,SAJT;AAAA,MAKA,QAAQ,GAMN,OAAO,CAND,QALR;AAAA,MAMA,WAAW,GAKT,OAAO,CALE,WANX;AAAA,MAOA,gBAAgB,GAId,OAAO,CAJO,gBAPhB;AAAA,MAQA,SAAS,GAGP,OAAO,CAHA,SART;AAAA,MASA,cAAc,GAEZ,OAAO,CAFK,cATd;AAAA,MAUA,SAAS,GACP,OAAO,CADA,SAVT;AAaF,MAAM,qBAAqB,GAAG,2BAA2B,CACvD,YAAY,CAAC,IAAD,EAAO,WAAP,EAAoB,WAApB,CAD2C,EAEvD,WAFuD,EAGvD,WAHuD,EAIvD,WAJuD,CAAzD,CAfwF,CAsBxF;;AACM,MAAA,EAAA,GAAmB,YAAY,CACnC;AACE,IAAA,SAAS,EAAA,SADX;AAEE,IAAA,WAAW,EAAE,mBAAmB,CAAC,WAAD,EAAc,gBAAd,EAAgC,MAAhC,CAFlC;AAGE,IAAA,SAAS,EAAE,iBAAiB,CAAC,SAAD,EAAY,cAAZ,EAA4B,KAA5B,CAH9B;AAIE,IAAA,QAAQ,EAAA,QAJV;AAKE,IAAA,SAAS,EAAA;AALX,GADmC,EAQnC,qBARmC,CAA/B;AAAA,MAAE,KAAK,GAAA,EAAA,CAAA,KAAP;AAAA,MAAS,KAAK,GAAA,EAAA,CAAA,KAAd,CAvBkF,CAkCxF;;;AACA,SAAO;AACL,IAAA,KAAK,EAAE,KAAK,CAAC,GAAN,CAAU,UAAC,IAAD,EAAK;AACpB,aAAO;AACL,QAAA,CAAC,EAAE,IAAI,CAAC,CADH;AAEL,QAAA,CAAC,EAAE,IAAI,CAAC,CAFH;AAGL,QAAA,IAAI,EAAE,IAAI,CAAC,IAHN;AAIL,QAAA,MAAM,EAAE;AAJH,OAAP;AAMD,KAPM,CADF;AASL,IAAA,KAAK,EAAE,KAAK,CAAC,GAAN,CAAU,UAAC,IAAD,EAAK;AACpB,aAAO;AACL,QAAA,MAAM,EAAE,IAAI,CAAC,MAAL,CAAY,IADf;AAEL,QAAA,MAAM,EAAE,IAAI,CAAC,MAAL,CAAY,IAFf;AAGL,QAAA,IAAI,EAAE,IAAI,CAAC,MAAL,CAAY,IAAZ,IAAoB,IAAI,CAAC,MAAL,CAAY,IAHjC;AAIL,QAAA,CAAC,EAAE,IAAI,CAAC,CAJH;AAKL,QAAA,CAAC,EAAE,IAAI,CAAC,CALH;AAML,QAAA,KAAK,EAAE,IAAI,CAAC,KANP;AAOL,QAAA,MAAM,EAAE;AAPH,OAAP;AASD,KAVM;AATF,GAAP;AAqBD","sourcesContent":["import { isRealNumber } from '../../utils/number';\nimport { transformDataToNodeLinkData } from '../../utils/data';\nimport { sankeyLayout } from './layout';\nimport { cutoffCircle } from './circle';\nimport { SankeyOptions } from './types';\n\nexport function getNodeWidthRatio(nodeWidth: number, nodeWidthRatio: number, width: number) {\n  return isRealNumber(nodeWidth) ? nodeWidth / width : nodeWidthRatio;\n}\n\nexport function getNodePaddingRatio(nodePadding: number, nodePaddingRatio: number, height: number) {\n  return isRealNumber(nodePadding) ? nodePadding / height : nodePaddingRatio;\n}\n\n/**\n * 将桑基图配置经过 layout，生成最终的 view 数据\n * @param options\n * @param width\n * @param height\n */\nexport function transformToViewsData(options: SankeyOptions, width: number, height: number) {\n  const {\n    data,\n    sourceField,\n    targetField,\n    weightField,\n    nodeAlign,\n    nodeSort,\n    nodePadding,\n    nodePaddingRatio,\n    nodeWidth,\n    nodeWidthRatio,\n    nodeDepth,\n  } = options;\n\n  const sankeyLayoutInputData = transformDataToNodeLinkData(\n    cutoffCircle(data, sourceField, targetField),\n    sourceField,\n    targetField,\n    weightField\n  );\n\n  // 3. layout 之后的数据\n  const { nodes, links } = sankeyLayout(\n    {\n      nodeAlign,\n      nodePadding: getNodePaddingRatio(nodePadding, nodePaddingRatio, height),\n      nodeWidth: getNodeWidthRatio(nodeWidth, nodeWidthRatio, width),\n      nodeSort,\n      nodeDepth,\n    },\n    sankeyLayoutInputData\n  );\n\n  // 4. 生成绘图数据\n  return {\n    nodes: nodes.map((node) => {\n      return {\n        x: node.x,\n        y: node.y,\n        name: node.name,\n        isNode: true,\n      };\n    }),\n    edges: links.map((link) => {\n      return {\n        source: link.source.name,\n        target: link.target.name,\n        name: link.source.name || link.target.name,\n        x: link.x,\n        y: link.y,\n        value: link.value,\n        isNode: false,\n      };\n    }),\n  };\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}